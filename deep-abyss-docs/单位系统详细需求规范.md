# 《深渊巢穴》单位系统详细需求规范

## 1. 系统概述

### 1.1 系统目的

单位系统是《深渊巢穴》游戏的核心执行系统，负责管理游戏中所有可控制和自主行动的生物实体。该系统将基因系统的抽象特性转化为具体的游戏行为和视觉表现，实现玩家战略意图的执行和游戏世界的动态演化。

### 1.2 系统范围

单位系统负责：
- 单位的创建、控制和销毁
- 单位属性和能力的实现
- 单位行为AI和决策逻辑
- 单位视觉表现和动画
- 单位间的互动和战斗
- 单位与环境的交互

单位系统不负责：
- 基因特性的定义和计算（由基因系统负责）
- 资源的生成和管理（由资源系统负责）
- 母巢的核心功能（由母巢系统负责）

### 1.3 系统依赖

单位系统依赖于：
- 基因系统：获取基因特性和进化数据
- 资源系统：消耗和生产资源
- 环境系统：获取环境信息和交互
- 战斗系统：执行战斗逻辑
- 母巢系统：接收指令和报告状态

## 2. 单位类型与分类

### 2.1 单位基本分类

| 分类维度 | 分类类型 | 特点描述 | 主要用途 | 视觉特征 |
|---------|---------|---------|---------|---------|
| 功能分类 | 工作单位 | 资源收集和建设能力强，战斗能力弱 | 资源采集，建设，探索 | 体型较小，工具化附肢，明亮色调 |
|  | 战斗单位 | 战斗能力强，资源效率低 | 防御，进攻，控制区域 | 体型较大，武器化附肢，暗沉色调 |
|  | 特殊单位 | 独特能力，高度专精 | 特殊任务，支援，控制 | 独特外观，异常结构，鲜明色彩 |
| 进化阶段 | 原始体 | 基础能力，低消耗，快速生产 | 早期扩张，基础工作 | 简单结构，单细胞形态，半透明 |
|  | 成熟体 | 平衡能力，中等消耗 | 主力部队，多功能工作 | 完整器官，多细胞结构，明确形态 |
|  | 精英体 | 高级能力，高消耗，生产缓慢 | 关键任务，精英战斗 | 复杂结构，特化器官，华丽外观 |
| 基因倾向 | 酸性单位 | 侵蚀能力，穿透防御 | 攻击有机目标，溶解障碍 | 流体状结构，酸性液体覆盖，绿色调 |
|  | 金属单位 | 高防御，物理攻击 | 前线作战，抵抗伤害 | 金属质感外壳，机械化结构，冷色调 |
|  | 能量单位 | 高机动，能量攻击 | 快速打击，控制区域 | 能量脉络明显，半透明结构，明亮色彩 |

### 2.2 单位详细类型

#### 2.2.1 工作单位

| 单位名称 | 主要功能 | 特殊能力 | 资源消耗 | 生产时间 | 进化路径 |
|---------|---------|---------|---------|---------|---------|
| 采集者 | 基础资源采集 | 资源探测，快速移动 | 低 | 10秒 | 采集者→高级采集者→资源专家 |
| 建设者 | 基础建设 | 快速建造，修复结构 | 中 | 15秒 | 建设者→构造师→建筑大师 |
| 探索者 | 地图探索 | 视野增强，隐身能力 | 低 | 12秒 | 探索者→侦察兵→先知 |
| 运输者 | 资源运输 | 大容量存储，快速移动 | 中 | 18秒 | 运输者→物流师→传送者 |
| 研究者 | 技术研究 | 加速研究，知识共享 | 高 | 25秒 | 研究者→科学家→启示者 |

#### 2.2.2 战斗单位

| 单位名称 | 主要功能 | 特殊能力 | 资源消耗 | 生产时间 | 进化路径 |
|---------|---------|---------|---------|---------|---------|
| 突击者 | 近战攻击 | 冲锋，连击 | 中 | 15秒 | 突击者→狂战士→毁灭者 |
| 射手 | 远程攻击 | 精准射击，穿透攻击 | 中 | 18秒 | 射手→狙击手→风暴弓手 |
| 防御者 | 承受伤害 | 护盾，嘲讽 | 高 | 22秒 | 防御者→守护者→不朽壁垒 |
| 控制者 | 群体控制 | 减速，眩晕 | 高 | 20秒 | 控制者→支配者→思维主宰 |
| 治疗者 | 单位恢复 | 治疗光环，净化 | 高 | 25秒 | 治疗者→生命使者→复苏大师 |

#### 2.2.3 特殊单位

| 单位名称 | 主要功能 | 特殊能力 | 资源消耗 | 生产时间 | 获取方式 |
|---------|---------|---------|---------|---------|---------|
| 基因工程师 | 基因操作 | 现场基因修改，基因提取 | 极高 | 40秒 | 特殊研究解锁 |
| 虚空行者 | 空间操控 | 传送，空间扭曲 | 极高 | 45秒 | 深渊探索发现 |
| 同化者 | 敌方转化 | 感染，控制敌方单位 | 极高 | 50秒 | 特殊任务奖励 |
| 先驱者 | 区域控制 | 创造有利环境，驱散负面效果 | 极高 | 60秒 | 高级进化解锁 |
| 深渊主宰 | 终极单位 | 多种强力能力组合 | 极高 | 120秒 | 主线任务完成 |

## 3. 单位属性系统

### 3.1 基础属性

| 属性名称 | 属性类型 | 取值范围 | 默认值 | 影响效果 | 显示方式 |
|---------|---------|---------|-------|---------|---------|
| 生命值 | 整数 | 50-10000 | 100 | 决定单位可承受的伤害量 | 生命条，数值显示 |
| 能量值 | 整数 | 0-1000 | 100 | 决定单位可使用的特殊能力次数 | 能量条，数值显示 |
| 移动速度 | 浮点数 | 0.5-10.0 | 3.0 | 决定单位移动速度 | 数值显示，移动动画 |
| 攻击力 | 整数 | 5-500 | 20 | 决定单位造成的基础伤害 | 数值显示，攻击动画 |
| 攻击速度 | 浮点数 | 0.5-5.0 | 1.0 | 决定单位攻击频率（次/秒） | 数值显示，攻击动画 |
| 攻击范围 | 浮点数 | 1.0-20.0 | 2.0 | 决定单位攻击距离 | 范围指示器 |
| 防御力 | 整数 | 0-100 | 10 | 减少受到的物理伤害 | 数值显示，受击动画 |
| 魔法抗性 | 整数 | 0-100 | 10 | 减少受到的能量伤害 | 数值显示，受击动画 |
| 视野范围 | 浮点数 | 3.0-30.0 | 8.0 | 决定单位可见范围 | 视野指示器 |
| 资源容量 | 整数 | 10-1000 | 50 | 决定单位可携带的资源量 | 数值显示，视觉指示器 |

### 3.2 高级属性

| 属性名称 | 属性类型 | 取值范围 | 默认值 | 影响效果 | 获取条件 |
|---------|---------|---------|-------|---------|---------|
| 暴击几率 | 百分比 | 0%-50% | 5% | 攻击造成额外伤害的几率 | 进化到成熟体 |
| 暴击伤害 | 百分比 | 120%-300% | 150% | 暴击时的伤害倍率 | 进化到成熟体 |
| 闪避几率 | 百分比 | 0%-30% | 3% | 完全避免受到伤害的几率 | 进化到成熟体 |
| 生命恢复 | 每秒点数 | 0-100 | 1 | 每秒恢复的生命值 | 特殊基因 |
| 能量恢复 | 每秒点数 | 0-50 | 2 | 每秒恢复的能量值 | 特殊基因 |
| 冷却减少 | 百分比 | 0%-40% | 0% | 技能冷却时间减少比例 | 精英进化 |
| 伤害反弹 | 百分比 | 0%-30% | 0% | 反弹给攻击者的伤害比例 | 特殊基因 |
| 资源效率 | 百分比 | 100%-200% | 100% | 资源采集和使用效率 | 工作单位进化 |
| 经验获取 | 百分比 | 100%-200% | 100% | 获得经验的倍率 | 任何单位 |
| 视野穿透 | 布尔值 | 是/否 | 否 | 是否可以看见隐藏单位 | 特殊进化 |

### 3.3 特殊状态

| 状态名称 | 持续时间 | 效果描述 | 视觉表现 | 触发条件 | 解除方式 |
|---------|---------|---------|---------|---------|---------|
| 狂暴 | 10秒 | 攻击速度+50%，移动速度+30%，防御-20% | 体型增大，红色光效，急促动画 | 特定技能，特殊条件 | 时间结束，净化 |
| 隐身 | 30秒 | 对敌方单位不可见，攻击解除隐身 | 半透明效果，波纹光效 | 特定技能，特殊环境 | 攻击，时间结束，被侦测 |
| 眩晕 | 2秒 | 无法移动和攻击 | 头顶星星，摇晃动画 | 敌方控制技能 | 时间结束，净化 |
| 中毒 | 8秒 | 每秒损失5%最大生命值 | 绿色气泡，痛苦动画 | 敌方毒素攻击 | 时间结束，净化，治疗 |
| 护盾 | 15秒 | 吸收等同于最大生命值30%的伤害 | 蓝色能量罩，受击波纹 | 防御技能，特殊道具 | 护盾耗尽，时间结束 |
| 加速 | 12秒 | 移动速度+100% | 速度线效果，加速动画 | 速度技能，特殊环境 | 时间结束 |
| 无敌 | 3秒 | 免疫所有伤害 | 金色光芒，强烈脉动 | 稀有技能，特殊条件 | 时间结束 |
| 虚弱 | 6秒 | 攻击力-50%，移动速度-30% | 灰色滤镜，缓慢动画 | 敌方削弱技能 | 时间结束，净化 |
| 恐惧 | 4秒 | 无法控制移动方向，远离恐惧源 | 惊恐表情，混乱动画 | 敌方恐惧技能 | 时间结束，净化 |
| 狂热 | 20秒 | 攻击力+30%，无视30%防御 | 火焰光效，激烈动画 | 特殊技能，特定条件 | 时间结束 |

## 4. 单位行为系统

### 4.1 基础行为

| 行为类型 | 触发条件 | 执行逻辑 | 动画表现 | 声音反馈 | 优先级 |
|---------|---------|---------|---------|---------|-------|
| 移动 | 玩家指令，自动寻路 | A*寻路算法，避障，地形适应 | 移动循环动画，转向过渡 | 脚步声，环境交互声 | 中 |
| 攻击 | 敌人进入攻击范围，玩家指令 | 目标选择，伤害计算，攻击冷却 | 攻击动画，命中特效 | 攻击音效，命中反馈 | 高 |
| 采集 | 资源点附近，玩家指令 | 资源获取计算，容量检查 | 采集动画，资源流动效果 | 采集音效，完成提示 | 中 |
| 建造 | 建造点附近，玩家指令 | 建造进度计算，资源消耗 | 建造动画，结构形成过程 | 建造音效，完成提示 | 中 |
| 巡逻 | 玩家指令，自动防御 | 路径循环，警戒范围检测 | 移动与观察交替动画 | 巡逻音效，发现警报 | 低 |
| 休息 | 无任务，能量恢复 | 恢复计算，周期检查 | 休息动画，恢复特效 | 休息音效，环境声 | 最低 |
| 死亡 | 生命值降至0 | 资源掉落，经验分配，尸体处理 | 死亡动画，解体效果 | 死亡音效，环境反应 | 最高 |
| 技能使用 | 玩家指令，自动触发条件 | 技能效果计算，冷却设置 | 技能动画，特效展示 | 技能音效，环境反应 | 高 |
| 交互 | 可交互物体附近，玩家指令 | 交互结果计算，状态更新 | 交互动画，物体反应 | 交互音效，结果反馈 | 中 |
| 逃跑 | 生命危险，战斗劣势 | 威胁评估，撤退路径计算 | 紧急移动动画，恐惧表现 | 警报音效，恐惧声音 | 高 |

### 4.2 高级行为

| 行为类型 | 触发条件 | 执行逻辑 | 行为参数 | 单位类型适用性 | 解锁条件 |
|---------|---------|---------|---------|--------------|---------|
| 群体协同 | 同类型单位聚集，特定任务 | 协同效率计算，任务分配 | 协同范围，效率提升，最大单位数 | 工作单位，部分战斗单位 | 群体意识基因 |
| 环境适应 | 进入特殊环境 | 环境效果计算，单位状态调整 | 适应速度，适应上限，能量消耗 | 所有单位 | 适应性基因 |
| 自主进化 | 经验达到阈值，资源充足 | 进化选项生成，资源消耗 | 进化时间，成功率，资源需求 | 所有可进化单位 | 进化潜力基因 |
| 战术定位 | 战斗开始，队形指令 | 位置优化计算，角色分配 | 队形类型，反应速度，维持距离 | 战斗单位 | 智能水平基因 |
| 资源优化 | 资源紧张，效率指令 | 资源价值评估，采集优先级 | 优化系数，决策周期，预测深度 | 工作单位 | 能量效率基因 |
| 自我修复 | 战斗结束，休息状态 | 修复速率计算，能量分配 | 修复速度，能量消耗，优先部位 | 所有单位 | 自愈能力基因 |
| 敌人分析 | 遭遇新敌人，战斗持续 | 弱点识别，战术调整 | 分析时间，精确度，记忆持久度 | 战斗单位，特殊单位 | 智能水平基因 |
| 区域控制 | 占领指令，防御需求 | 控制点分配，巡逻路径生成 | 控制范围，单位分布，反应时间 | 战斗单位，特殊单位 | 高级战术训练 |
| 资源转化 | 资源过剩，需求变化 | 转化效率计算，优先级分配 | 转化速率，损耗比例，批量大小 | 特殊单位 | 特殊基因组合 |
| 异常处理 | 遭遇未知情况，系统冲突 | 风险评估，应急方案选择 | 决策时间，风险承受度，报告优先级 | 高智能单位 | 高级智能水平 |

### 4.3 AI决策系统

| 决策层级 | 决策内容 | 影响因素 | 决策周期 | 优先级规则 | 玩家干预方式 |
|---------|---------|---------|---------|---------|------------|
| 战略层 | 整体目标，资源分配，发展方向 | 游戏阶段，资源状况，敌情分析 | 60秒 | 生存>发展>进攻 | 战略指令，目标设定 |
| 战术层 | 单位分组，区域控制，战斗部署 | 地形分析，敌我实力对比，关键资源 | 15秒 | 关键点控制>资源获取>单位保全 | 战术指令，分组管理 |
| 操作层 | 具体移动，技能使用，目标选择 | 即时战场状况，单位状态，敌人行为 | 3秒 | 威胁消除>任务完成>效率最大化 | 直接控制，技能触发 |
| 反应层 | 紧急避险，突发情况处理 | 突发伤害，环境变化，新敌人出现 | 实时 | 生存>任务完成>资源保全 | 紧急命令，手动接管 |

#### 4.3.1 工作单位AI

```
function WorkerUnitAI() {
    // 状态评估
    AssessCurrentState();
    
    // 紧急情况处理
    if (IsInDanger()) {
        ExecuteEmergencyProtocol();
        return;
    }
    
    // 资源管理
    if (IsResourceFull()) {
        ReturnResourceToBase();
        return;
    }
    
    // 主要任务执行
    switch (currentTask) {
        case TaskType.Gather:
            ExecuteGatheringBehavior();
            break;
        case TaskType.Build:
            ExecuteBuildingBehavior();
            break;
        case TaskType.Explore:
            ExecuteExplorationBehavior();
            break;
        case TaskType.Transport:
            ExecuteTransportBehavior();
            break;
        case TaskType.Research:
            ExecuteResearchBehavior();
            break;
        default:
            FindOptimalTask();
            break;
    }
    
    // 环境适应
    AdaptToEnvironment();
    
    // 群体协同检查
    CheckForGroupCoordination();
}
```

#### 4.3.2 战斗单位AI

```
function CombatUnitAI() {
    // 状态评估
    AssessCurrentState();
    
    // 战斗状态检查
    if (IsInCombat()) {
        // 目标选择
        SelectOptimalTarget();
        
        // 战术定位
        OptimizePosition();
        
        // 技能使用决策
        DecideSkillUsage();
        
        // 执行攻击
        ExecuteAttack();
        return;
    }
    
    // 非战斗状态行为
    switch (currentOrder) {
        case OrderType.Patrol:
            ExecutePatrolBehavior();
            break;
        case OrderType.Guard:
            ExecuteGuardBehavior();
            break;
        case OrderType.Move:
            ExecuteMoveBehavior();
            break;
        case OrderType.Follow:
            ExecuteFollowBehavior();
            break;
        default:
            ExecuteIdleBehavior();
            break;
    }
    
    // 敌人探测
    ScanForEnemies();
    
    // 自我恢复
    SelfRecovery();
}
```

## 5. 单位能力系统

### 5.1 基础能力

| 能力名称 | 能力类型 | 效果描述 | 能量消耗 | 冷却时间 | 解锁条件 |
|---------|---------|---------|---------|---------|---------|
| 快速移动 | 主动 | 移动速度+100%，持续5秒 | 20 | 15秒 | 默认解锁 |
| 基础攻击 | 被动 | 造成基础攻击力伤害 | 0 | 攻击间隔 | 默认解锁 |
| 资源探测 | 主动 | 显示周围30米内的资源点 | 10 | 30秒 | 默认解锁(工作单位) |
| 紧急修复 | 主动 | 立即恢复20%最大生命值 | 30 | 60秒 | 默认解锁 |
| 警戒姿态 | 切换 | 攻击范围+20%，移动速度-20% | 5/秒 | 无 | 默认解锁(战斗单位) |
| 资源存储 | 被动 | 增加10%资源携带上限 | 0 | 无 | 默认解锁(工作单位) |
| 战斗嗅觉 | 被动 | 感知15米内的隐形单位 | 0 | 无 | 默认解锁(特定单位) |
| 能量共享 | 主动 | 向目标友方单位转移50点能量 | 60 | 45秒 | 默认解锁(特定单位) |
| 基础建造 | 主动 | 建造基础结构 | 因结构而异 | 无 | 默认解锁(建设单位) |
| 自然恢复 | 被动 | 每秒恢复1%最大生命值 | 0 | 无 | 默认解锁 |

### 5.2 高级能力

| 能力名称 | 能力类型 | 效果描述 | 能量消耗 | 冷却时间 | 获取方式 |
|---------|---------|---------|---------|---------|---------|
| 酸液喷射 | 主动 | 对锥形区域造成酸性伤害，降低目标30%防御，持续8秒 | 40 | 20秒 | 酸性基因进化 |
| 金属护盾 | 主动 | 生成吸收100%最大生命值伤害的护盾，持续12秒 | 60 | 45秒 | 金属基因进化 |
| 能量爆发 | 主动 | 对周围敌人造成150%攻击力的能量伤害，击退5米 | 80 | 30秒 | 能量基因进化 |
| 虚空传送 | 主动 | 传送到20米内的可见位置 | 70 | 60秒 | 虚空基因进化 |
| 生命汲取 | 主动 | 对目标造成50%攻击力伤害，恢复自身等量生命值 | 35 | 25秒 | 有机基因进化 |
| 区域净化 | 主动 | 清除10米范围内的所有负面效果，包括友军 | 50 | 40秒 | 碱性基因进化 |
| 基因分析 | 主动 | 分析目标单位，提供其弱点信息，对其伤害+20%，持续30秒 | 45 | 35秒 | 研究单位进化 |
| 群体意识 | 被动 | 周围10米内每有一个同类型友军，属性+3%(最多+15%) | 0 | 无 | 群体意识基因 |
| 适应迷彩 | 主动 | 根据环境获得隐身效果，移动速度-30%，持续直到移动或攻击 | 55 | 50秒 | 适应性基因进化 |
| 狂暴进化 | 主动 | 临时进化为更高级形态，属性全面提升，持续15秒，之后虚弱10秒 | 100 | 120秒 | 进化潜力基因 |

### 5.3 终极能力

| 能力名称 | 获取条件 | 效果描述 | 能量消耗 | 冷却时间 | 视觉表现 |
|---------|---------|---------|---------|---------|---------|
| 深渊降临 | 深渊主宰解锁 | 召唤深渊能量，对大范围内敌人造成巨大伤害并施加随机负面效果 | 200 | 300秒 | 深渊裂缝出现，黑紫色能量爆发，环境扭曲 |
| 基因重组 | 基因工程师精英进化 | 立即重组目标友军的基因结构，随机强化一项属性50%，